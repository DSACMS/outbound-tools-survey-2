<html>
	<head>
		<!-- USWDS not working -->
		<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
		<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> -->
		<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uswds/2.11.2/css/uswds.min.css"> -->
		<!-- <link rel="stylesheet" href="https://cdn.form.io/formiojs/formio.form.min.css"> -->
		<!-- <link rel="stylesheet" href="https://cdn.form.io/uswds/uswds.min.css"> -->
		<!-- <link rel="stylesheet" href="https://unpkg.com/formiojs@3.0.0-alpha.13/dist/formio.full.min.css"> -->
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/uswds/2.11.2/js/uswds.min.js"></script> -->
		<!-- <script src="https://cdn.form.io/formiojs/formio.form.min.js"></script> -->
		<!-- <script src="https://cdn.form.io/uswds/uswds.min.js"></script> -->
		<!-- <script src="https://cdn.form.io/formiojs/formio.full.js"></script> -->
		<!-- <script src="https://cdn.form.io/js/formio.embed.js"></script> -->

		<!-- Uses bootstrap for now -->
		<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
		<link rel="stylesheet" href="css/styles.css">

		<!-- Working Form.io CDN -->
		<script src="https://unpkg.com/formiojs@4.21.6/dist/formio.full.min.js"></script>
		<link href="https://cdn.jsdelivr.net/npm/formiojs@4.21.6/dist/formio.full.min.css" rel="stylesheet">
	</head>
	<body>
		<div class="container">
			<div id="form-header"></div>
			<div id="formio"></div>

			<!-- Hidden until submission -->
			<div id="form-actions" style="display: none; margin-top: 20px;">
				<h3>Form Submitted Successfully</h3>
				<p>Download or copy the JSON data below:</p>

				<div class="form-group">
					<label for="json-result">JSON Data</label>
					<textarea class="form-control" rows="10" id="json-result" readonly></textarea>
				</div>
				
				<div class="btn-group">
					<button id="download-json" class="btn btn-primary">Download JSON</button>
					<button id="copy-json" class="btn btn-default" style="margin-left: 10px;">Copy JSON</button>
					<button id="email-json" class="btn btn-success" style="margin-left: 10px;">Email JSON</button>
				</div>
			</div>
		</div>
		
		<!-- Scripts -->
		<script src="js/retrieveFile.js"></script>
		<script src="js/generateFormComponents.js"></script>
		<script src="js/formDataToJson.js"></script>
		<script src="js/formActions.js"></script>

		<script type="text/javascript">
			document.addEventListener("DOMContentLoaded", function() {
				createFormComponents()
					.then((components) => {
						Formio.createForm(document.getElementById("formio"), {
							components: components,
						}).then(function (form) {
							form.on("submit", function (submission) {
								console.log("Form Submission: ", submission.data);

								window.lastSubmission = submission.data;

								const cleanData = {...submission.data};
								delete cleanData.submit;

								const jsonString = JSON.stringify(cleanData, null, 2);
								document.getElementById('json-result').value = jsonString;

								document.getElementById('form-actions').style.display = 'block';

								document.getElementById('form-actions').scrollIntoView({
									behavior: 'smooth'
								});
							});
						});
					})
					.catch((error) => {
						console.error("Error creating components:", error);
				});
			});
		</script>
	</body>
</html>
